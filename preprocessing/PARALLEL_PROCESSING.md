# 병렬 처리 가이드

## 개요

날짜별 전처리를 병렬로 처리하여 처리 속도를 크게 향상시킬 수 있습니다. 동시에 여러 날짜를 처리하므로 전체 처리 시간이 단축됩니다.

## 설정 방법

### 1. 설정 파일 수정

`preprocessing_config.yaml` 파일에서 다음 설정을 활성화하세요:

```yaml
# 병렬 처리 설정
parallel: true            # 병렬 처리 활성화
max_workers: 8           # 최대 동시 처리 프로세스 수
```

### 2. 권장 설정

- **CPU 코어 수에 맞춰 조정**: `max_workers`는 시스템의 CPU 코어 수를 고려하여 설정하세요.
  - 4코어: `max_workers: 4`
  - 8코어: `max_workers: 8`
  - 16코어: `max_workers: 16`
  
- **메모리 고려**: 각 프로세스가 독립적으로 메모리를 사용하므로, 전체 메모리 사용량은 `max_workers × (단일 날짜 처리 메모리)`가 됩니다.

## 작동 방식

1. **날짜별 분류**: 로그 파일들을 날짜별로 분류합니다.
2. **병렬 처리**: 각 날짜를 독립적인 프로세스로 처리합니다.
3. **결과 저장**: 각 날짜별로 `preprocessed_logs_YYYY-MM-DD.json` 파일이 생성됩니다.

## 성능 향상

- **순차 처리**: 날짜가 10개이고 각각 1시간이 걸린다면 → 총 10시간
- **병렬 처리 (8 workers)**: 동일한 조건에서 → 약 1.5~2시간 (오버헤드 포함)

## 주의사항

1. **메모리 사용량**: 병렬 처리 시 메모리 사용량이 증가합니다.
   - 순차 처리: 약 1-2GB
   - 병렬 처리 (8 workers): 약 8-16GB

2. **디스크 I/O**: 여러 프로세스가 동시에 파일을 읽고 쓰므로, SSD를 사용하는 것이 권장됩니다.

3. **프로세스 수 제한**: 너무 많은 프로세스를 사용하면 오히려 성능이 저하될 수 있습니다.

## 실행 예시

```bash
cd preprocessing
conda activate radar
python log_preprocessor.py
```

설정 파일에서 `parallel: true`로 설정되어 있으면 자동으로 병렬 처리가 활성화됩니다.

## 로그 확인

병렬 처리 중에는 다음과 같은 로그가 출력됩니다:

```
병렬 처리 모드 활성화 (최대 8개 프로세스)
[병렬] 날짜별 처리 시작: 2025-08-22 (5개 파일)
[병렬] 날짜별 처리 시작: 2025-08-23 (3개 파일)
...
✅ 2025-08-22: 완료
✅ 2025-08-23: 완료
병렬 처리 완료: 성공 10개, 실패 0개
```

## 문제 해결

### 메모리 부족 오류

- `max_workers` 수를 줄이세요 (예: 8 → 4)
- `stream_mode: true`로 설정되어 있는지 확인하세요

### 처리 실패

- 로그에서 실패한 날짜를 확인하세요
- 실패한 날짜만 다시 처리하려면 `date_filter`를 사용하세요

