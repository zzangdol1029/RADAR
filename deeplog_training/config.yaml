# DeepLog 학습 설정 파일
# Tesla V100-DGXS-32GB x 4 환경에 최적화

# 모델 설정
model:
  vocab_size: 10000          # 어휘 크기 (Event ID + Special Tokens)
  embedding_dim: 128         # 임베딩 차원
  hidden_size: 256           # LSTM 은닉층 크기
  num_layers: 2              # LSTM 레이어 수
  dropout: 0.2               # 드롭아웃 확률

# 학습 설정
training:
  batch_size: 1024            # ✅ 배치 크기 변경: 512 → 1024 (4 GPU, GPU당 256)
  learning_rate: 0.001        # 초기 학습률
  weight_decay: 0.0001        # 가중치 감쇠 (L2 정규화)
  num_epochs: 50              # 총 에폭 수
  max_grad_norm: 1.0          # Gradient Clipping 최대값
  
  # 스케줄러 설정
  scheduler_type: "reduce_on_plateau"  # ReduceLROnPlateau 사용
  min_lr: 0.000001            # 최소 학습률
  warmup_steps: 500           # ✅ 워밍업 스텝 감소 (batch 1024에 맞춰 조정)
  
  # 로깅 설정
  log_interval: 50            # 배치별 로그 출력 간격
  save_interval: 1500         # 체크포인트 저장 간격 (스텝)
  
  # ✅ Early Stopping 설정 (활성화)
  early_stopping:
    enabled: true             # Early Stopping 활성화
    patience: 5               # 5 에폭 동안 개선 없으면 종료
    min_delta: 0.0001         # 개선으로 간주되는 최소 변화량

  # ✅ ReduceLROnPlateau 파라미터
  lr_scheduler:
    factor: 0.5               # 학습률 감소 비율 (1/2로 감소)
    patience: 2               # 2 에폭 개선 없으면 학습률 감소 (Early Stopping보다 짧게)
    min_lr: 0.000001          # 최소 학습률
    threshold: 0.0001         # 개선 판단 임계값

  # GPU 설정
  use_multi_gpu: true         # 멀티 GPU 사용 여부
  mixed_precision: true       # Mixed Precision Training (FP16)
  
  # 데이터 로더 설정
  num_workers: 16             # 데이터 로딩 워커 수
  prefetch_factor: 4          # 프리페치 팩터

# 데이터 설정
data:
  preprocessed_dir: "/home/zzangdol/RADAR/preprocessing/output"
  max_seq_length: 512         # 최대 시퀀스 길이
  validation_split: 0.1       # ✅ 검증 데이터 비율 (10%)
  file_pattern: "preprocessed_logs_*.json"
  
  # Lazy Loading 설정
  lazy_loading:
    enabled: true
    buffer_size: 20000        # ✅ 버퍼 크기 증가 (batch 1024에 맞춰)
    shuffle_buffer: true

# 출력 설정
output:
  base_dir: "/home/zzangdol/silverw/deeplog"
  dir: "/home/zzangdol/silverw/deeplog/output"
  checkpoint_dir: "checkpoints"
  log_file: "training.log"
  eval_dir: "/home/zzangdol/silverw/deeplog"

# 모니터링 설정
monitoring:
  gpu_log_interval: 50
  use_tensorboard: false
  tensorboard_dir: "runs"

#  Top-g Accuracy 평가 설정 추가
evaluation:
  top_g: 9                    # DeepLog 논문 기준 g=9
  eval_interval: 1            # 매 에폭마다 평가