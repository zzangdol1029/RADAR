# 이상 탐지 성능 지표 설명

## 📊 세 가지 핵심 지표

### 1. 정확도 (Accuracy)

**정의**: 전체 예측 중 올바르게 예측한 비율

```
정확도 = (맞게 예측한 개수) / (전체 개수)
       = (TP + TN) / (TP + TN + FP + FN)
```

**의미**: 모델이 전체적으로 얼마나 정확한가?

**예시:**
```
전체 로그 세션: 1000개
- 정상으로 예측: 900개 (중 850개가 실제 정상, 50개는 실제 이상)
- 이상으로 예측: 100개 (중 80개가 실제 이상, 20개는 실제 정상)

정확도 = (850 + 80) / 1000 = 930 / 1000 = 93%
```

**해석**: 93%의 예측이 정확함

---

### 2. 정밀도 (Precision)

**정의**: 이상으로 예측한 것 중 실제로 이상인 비율

```
정밀도 = TP / (TP + FP)
       = (실제 이상이고 이상으로 예측) / (이상으로 예측한 전체)
```

**의미**: 이상으로 예측했을 때, 실제로 이상일 확률이 얼마나 높은가?

**예시:**
```
이상으로 예측한 세션: 100개
- 실제 이상: 80개 (TP)
- 실제 정상: 20개 (FP) ← 오탐 (False Positive)

정밀도 = 80 / 100 = 80%
```

**해석**: 이상으로 예측한 것 중 80%가 실제 이상

**중요성**: 
- 정밀도가 낮으면 → 오탐이 많음
- "이상 경고"가 많이 발생 → 신뢰도 낮음
- 운영팀이 경고를 무시하게 됨

---

### 3. 재현율 (Recall)

**정의**: 실제 이상 중 이상으로 탐지한 비율

```
재현율 = TP / (TP + FN)
       = (실제 이상이고 이상으로 예측) / (실제 이상 전체)
```

**의미**: 실제 이상을 얼마나 많이 찾아냈는가?

**예시:**
```
실제 이상 세션: 100개
- 이상으로 탐지: 80개 (TP)
- 정상으로 오탐지: 20개 (FN) ← 미탐지 (False Negative)

재현율 = 80 / 100 = 80%
```

**해석**: 실제 이상 중 80%를 탐지함

**중요성**:
- 재현율이 낮으면 → 실제 이상을 놓침
- 중요한 장애를 놓칠 수 있음
- 보안/안정성 문제 발생 가능

---

## 📈 혼동 행렬 (Confusion Matrix)

### 기본 구조

```
                    실제
              정상    이상
예측  정상   TN      FN
      이상   FP      TP
```

**용어 설명:**
- **TP (True Positive)**: 실제 이상이고 이상으로 예측 ✅
- **TN (True Negative)**: 실제 정상이고 정상으로 예측 ✅
- **FP (False Positive)**: 실제 정상인데 이상으로 예측 ❌ (오탐)
- **FN (False Negative)**: 실제 이상인데 정상으로 예측 ❌ (미탐지)

### 예시

```
전체 세션: 1000개
실제 정상: 900개
실제 이상: 100개

예측 결과:
              실제
          정상    이상
예측 정상  850    20
     이상   50    80

TP = 80 (실제 이상, 이상으로 예측)
TN = 850 (실제 정상, 정상으로 예측)
FP = 50 (실제 정상, 이상으로 예측) ← 오탐
FN = 20 (실제 이상, 정상으로 예측) ← 미탐지
```

---

## 🎯 세 지표 계산 예시

### 예시 데이터

```
전체 세션: 1000개
실제 정상: 900개
실제 이상: 100개

예측 결과:
- 정상으로 예측: 870개
  - 실제 정상: 850개 (TN)
  - 실제 이상: 20개 (FN) ← 놓친 이상
  
- 이상으로 예측: 130개
  - 실제 정상: 50개 (FP) ← 오탐
  - 실제 이상: 80개 (TP) ← 정확한 탐지
```

### 계산

#### 1. 정확도 (Accuracy)

```
정확도 = (TP + TN) / 전체
       = (80 + 850) / 1000
       = 930 / 1000
       = 93%
```

**의미**: 전체 예측 중 93%가 정확함

#### 2. 정밀도 (Precision)

```
정밀도 = TP / (TP + FP)
       = 80 / (80 + 50)
       = 80 / 130
       = 61.5%
```

**의미**: 이상으로 예측한 것 중 61.5%가 실제 이상

#### 3. 재현율 (Recall)

```
재현율 = TP / (TP + FN)
       = 80 / (80 + 20)
       = 80 / 100
       = 80%
```

**의미**: 실제 이상 중 80%를 탐지함

---

## 💡 각 지표의 중요성

### 정확도 (Accuracy)

**장점:**
- 이해하기 쉬움
- 전체적인 성능 파악

**단점:**
- 불균형 데이터에서 오해의 소지
- 예: 정상 99%, 이상 1% → 모두 정상으로 예측해도 99% 정확도

**사용 시기:**
- 데이터가 균형적일 때
- 전체적인 성능 파악

---

### 정밀도 (Precision)

**중요성:**
- 오탐(False Positive)을 줄이는 것이 중요할 때
- 경고 시스템에서 신뢰도 확보

**높은 정밀도가 중요한 경우:**
- 운영팀이 경고를 확인하는 비용이 높을 때
- "이상 경고"가 많으면 신뢰도 하락
- 자동화된 대응 시스템

**예시:**
```
정밀도 80% = 이상으로 예측한 것 중 80%가 실제 이상
→ 경고 10개 중 8개가 실제 이상
→ 운영팀이 신뢰할 수 있음

정밀도 30% = 이상으로 예측한 것 중 30%가 실제 이상
→ 경고 10개 중 3개만 실제 이상
→ 운영팀이 경고를 무시하게 됨
```

---

### 재현율 (Recall)

**중요성:**
- 실제 이상을 놓치지 않는 것이 중요할 때
- 보안/안정성 문제

**높은 재현율이 중요한 경우:**
- 중요한 장애를 놓치면 안 될 때
- 보안 위협 탐지
- 치명적인 오류 탐지

**예시:**
```
재현율 80% = 실제 이상 100개 중 80개 탐지
→ 20개는 놓침

재현율 95% = 실제 이상 100개 중 95개 탐지
→ 5개만 놓침 (더 안전)
```

---

## ⚖️ 정밀도 vs 재현율 트레이드오프

### 일반적인 관계

```
정밀도 ↑ → 재현율 ↓
재현율 ↑ → 정밀도 ↓
```

**이유:**
- 임계값(Threshold)을 낮추면 → 더 많이 이상으로 예측 → 재현율 ↑, 정밀도 ↓
- 임계값을 높이면 → 덜 이상으로 예측 → 정밀도 ↑, 재현율 ↓

### 예시

#### 임계값 낮음 (재현율 우선)

```
임계값: 1.0 (낮음)
→ 더 많은 세션을 이상으로 예측

결과:
- 재현율: 95% (거의 모든 이상 탐지)
- 정밀도: 50% (오탐 많음)
```

**장점**: 실제 이상을 거의 놓치지 않음
**단점**: 오탐이 많아 경고가 빈번함

#### 임계값 높음 (정밀도 우선)

```
임계값: 3.0 (높음)
→ 확실한 것만 이상으로 예측

결과:
- 재현율: 60% (일부 이상 놓침)
- 정밀도: 90% (오탐 적음)
```

**장점**: 경고가 정확함
**단점**: 일부 이상을 놓칠 수 있음

---

## 🎯 이상 탐지에서의 권장 지표

### 일반적인 목표

| 지표 | 목표 | 이유 |
|------|------|------|
| **정확도** | 85-92% | 전체적인 정확도 |
| **정밀도** | 80-88% | 오탐 최소화 (신뢰도) |
| **재현율** | 75-85% | 실제 이상 탐지 (안정성) |

### 상황별 우선순위

#### 보안/안정성 중요 (재현율 우선)

```
재현율 > 정밀도
→ 실제 이상을 놓치지 않는 것이 중요
→ 오탐이 있어도 괜찮음
```

**예시:**
- 보안 위협 탐지
- 치명적인 오류 탐지
- 금융 거래 이상 탐지

#### 운영 효율 중요 (정밀도 우선)

```
정밀도 > 재현율
→ 경고의 정확도가 중요
→ 오탐을 최소화
```

**예시:**
- 자동화된 대응 시스템
- 운영팀 리소스 제한
- 경고 확인 비용이 높을 때

---

## 📊 F1-Score (종합 지표)

### 정의

```
F1-Score = 2 × (정밀도 × 재현율) / (정밀도 + 재현율)
```

**의미**: 정밀도와 재현율의 조화 평균

**장점:**
- 두 지표를 균형있게 고려
- 하나의 지표로 성능 파악

**예시:**
```
정밀도: 80%
재현율: 80%

F1-Score = 2 × (0.8 × 0.8) / (0.8 + 0.8)
         = 2 × 0.64 / 1.6
         = 1.28 / 1.6
         = 0.8 (80%)
```

---

## 💡 실용적인 해석

### 예시: Loss 1.0 ~ 1.5 모델

```
정확도: 85-92%
정밀도: 80-88%
재현율: 75-85%
```

**해석:**

1. **정확도 85-92%**
   - 전체 예측 중 85-92%가 정확함
   - 1000개 세션 중 850-920개를 정확히 예측

2. **정밀도 80-88%**
   - 이상으로 예측한 것 중 80-88%가 실제 이상
   - 경고 100개 중 80-88개가 실제 이상
   - 오탐 12-20개 (수용 가능)

3. **재현율 75-85%**
   - 실제 이상 중 75-85%를 탐지
   - 실제 이상 100개 중 75-85개 탐지
   - 미탐지 15-25개 (주의 필요)

**실용성:**
- ✅ 프로덕션 사용 가능
- ✅ 대부분의 이상 탐지 가능
- ⚠️ 일부 이상은 놓칠 수 있음 (재현율 75-85%)

---

## 📝 요약

### 세 지표의 핵심

| 지표 | 질문 | 중요성 |
|------|------|--------|
| **정확도** | 전체적으로 얼마나 정확한가? | 전체 성능 파악 |
| **정밀도** | 이상으로 예측한 것 중 실제 이상인가? | 오탐 최소화 |
| **재현율** | 실제 이상을 얼마나 찾았는가? | 미탐지 최소화 |

### 이상 탐지에서의 의미

- **정밀도 높음**: 경고가 정확함 → 신뢰도 높음
- **재현율 높음**: 실제 이상을 많이 찾음 → 안정성 높음
- **둘 다 높음**: 이상적인 모델 (일반적으로 트레이드오프 존재)

**현재 모델 예상 성능 (Loss 1.0 ~ 1.5):**
- 정확도 85-92%: 전체적으로 정확함
- 정밀도 80-88%: 경고 신뢰도 높음
- 재현율 75-85%: 대부분의 이상 탐지 가능

**→ 실용적인 이상 탐지 시스템으로 사용 가능!** ✅

